<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catatan Pribadi âœ¦</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body{font-family:'Inter',sans-serif}
    .fade-enter{opacity:0;transform:translateY(6px)}
    .fade-enter-active{opacity:1;transform:none;transition:all .35s cubic-bezier(.4,0,.2,1)}
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-violet-600 via-indigo-600 to-sky-600 text-white flex flex-col items-center py-10 px-4 relative">
  <!-- Tema -->
  <button id="themeToggle" class="absolute top-4 right-4 p-2 rounded-full backdrop-blur-sm bg-white/20 hover:bg-white/30">ðŸŒ“</button>

  <header class="text-center mb-8">
    <h1 class="text-4xl font-bold drop-shadow">Catatan Pribadi</h1>
    <p class="text-indigo-100 mt-2">Tulis rahasia, inspirasi, & simpan aman âœ¨</p>
  </header>

  <!-- BOX LOGIN -->
  <div id="loginBox" class="flex flex-col items-center gap-4 mb-8">
    <button id="googleBtn" class="flex items-center gap-2 px-5 py-2 rounded-lg bg-white text-indigo-700 font-semibold shadow hover:shadow-lg active:scale-95 transition">Masuk dengan Google</button>
  </div>

  <!-- TOOLS BAR -->
  <div id="toolsBar" class="w-full max-w-2xl mb-4 hidden">
    <div class="flex items-center gap-3">
      <input id="searchInput" type="text" placeholder="Cari catatanâ€¦" class="flex-1 p-2 rounded-lg bg-white/20 placeholder:text-white/70 focus:ring focus:outline-none">
      <select id="sortSelect" class="p-2 rounded-lg bg-white/20 focus:ring outline-none">
        <option value="desc">Terbaru</option>
        <option value="asc">Terlama</option>
      </select>
      <button id="exportBtn" class="px-3 py-2 rounded-lg bg-white text-indigo-700 font-semibold shadow hover:shadow-lg">Ekspor .txt</button>
    </div>
  </div>

  <!-- Form catatan -->
  <form id="noteForm.onsubmit=async e=>{
  e.preventDefault();
  const text=noteInput.value.trim();
  if(!text) return;
  await db.collection('notes').add({
    uid: currentUID,
    email: auth.currentUser.email,
    text,
    ts: firebase.firestore.Timestamp.fromDate(new Date()) // lokal dulu supaya langsung muncul
  });
  noteInput.value='';
};

// Export txt
exportBtn.onclick=()=>{
  if(!cachedNotes.length) return alert('Tidak ada catatan.');
  const lines=cachedNotes.map(n=>- ${n.text.replace(/\n/g,' ')} ( ${n.ts?timeAgo(n.ts.toDate()):''} ));
  const blob=new Blob([lines.join('\n')],{type:'text/plain'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');a.href=url;a.download='catatan.txt';a.click();URL.revokeObjectURL(url);
};
</script>
</body>
</html>
