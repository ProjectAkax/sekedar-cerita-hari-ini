<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catatan Pribadi âœ¦</title>
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Inter font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body{font-family:'Inter',sans-serif}
    .fade-enter{opacity:0;transform:translateY(6px)}
    .fade-enter-active{opacity:1;transform:none;transition:all .35s cubic-bezier(.4,0,.2,1)}
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-violet-600 via-indigo-600 to-sky-600 text-white flex flex-col items-center py-10 px-4 relative">
  <!-- Tema -->
  <button id="themeToggle" class="absolute top-4 right-4 p-2 rounded-full backdrop-blur-sm bg-white/20 hover:bg-white/30">ðŸŒ“</button>

  <header class="text-center mb-8">
    <h1 class="text-4xl font-bold drop-shadow">Catatan Pribadi</h1>
    <p class="text-indigo-100 mt-2">Tulis rahasia atau inspirasi âœ¨</p>
  </header>

  <!-- Form catatan -->
  <form id="noteForm" class="w-full max-w-2xl mb-10 backdrop-blur-sm bg-white/10 p-6 rounded-2xl shadow-xl ring-1 ring-white/20 hidden">
    <input id="nameInput" type="text" placeholder="Nama (opsional)" class="w-full mb-3 p-3 bg-transparent border border-white/30 rounded-lg placeholder:text-white/60 focus:ring-2 focus:ring-white/60">
    <textarea id="noteInput" rows="4" placeholder="Tulis catatanmu di siniâ€¦" class="w-full p-3 bg-transparent border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-white/60 placeholder:italic placeholder:text-white/70 resize-none"></textarea>
    <div class="flex justify-end mt-4 gap-2">
      <button type="submit" class="px-6 py-2 rounded-lg bg-white text-indigo-700 font-semibold shadow-lg hover:shadow-xl active:scale-95 transition">Simpan</button>
      <button id="logoutBtn" type="button" class="px-4 py-2 rounded-lg bg-red-600 text-white shadow hover:bg-red-700">Keluar</button>
    </div>
  </form>

  <!-- Daftar catatan -->
  <section id="notesList" class="w-full max-w-2xl space-y-6"></section>

  <template id="noteCardTpl">
    <article class="fade-enter bg-white/20 backdrop-blur-md p-5 rounded-2xl shadow-lg relative">
      <p class="whitespace-pre-wrap text-lg"></p>
      <div class="flex items-center justify-between mt-3">
        <time class="text-sm text-white/70"></time>
        <span class="text-sm text-white/80" data-author></span>
      </div>
      <button class="absolute top-3 right-3 text-white/70 hover:text-red-400">âœ•</button>
    </article>
  </template>

  <script>
    // ===== THEMING =====
    const themeToggle=document.getElementById('themeToggle');
    if(localStorage.getItem('notes_theme')==='dark')document.documentElement.classList.add('dark');
    themeToggle.onclick=()=>{
      document.documentElement.classList.toggle('dark');
      localStorage.setItem('notes_theme',document.documentElement.classList.contains('dark')?'dark':'light');
    };

    // ===== FIREBASE CONFIG =====
    const firebaseConfig={
      apiKey:"AIzaSyALhq63aB4_WegW0EeEmeKqf3TLbhaAu4A",
      authDomain:"akaxproject.firebaseapp.com",
      projectId:"akaxproject",
      storageBucket:"akaxproject.appspot.com",
      messagingSenderId:"780230212659",
      appId:"1:780230212659:web:97923cc2559b479f8af746"
    };
    firebase.initializeApp(firebaseConfig);
    const auth=firebase.auth();
    const db=firebase.firestore();
    const ADMIN_UID="2Y6k3Vf8uYPKm5inAJvShrkczKy1";

    // ===== ELEMENTS =====
    const noteForm=document.getElementById('noteForm');
    const nameInput=document.getElementById('nameInput');
    const noteInput=document.getElementById('noteInput');
    const notesList=document.getElementById('notesList');
    const tpl=document.getElementById('noteCardTpl');
    const logoutBtn=document.getElementById('logoutBtn');
    let currentUID=null;

    // ===== UTIL =====
    const timeAgo=ms=>{const d=Math.floor((Date.now()-ms)/864e5),h=Math.floor((Date.now()-ms)/36e5),m=Math.floor((Date.now()-ms)/6e4);return d?d+" hari lalu":h?h+" jam lalu":m?m+" menit lalu":"Baru saja"};

    // ===== AUTH =====
    auth.onAuthStateChanged(async user=>{
      if(!user){await auth.signInAnonymously();return;}
      currentUID=user.uid;
      noteForm.classList.remove('hidden');
      listenNotes(user.uid===ADMIN_UID);
    });
    logoutBtn.onclick=()=>auth.signOut();

    // ===== LISTENER =====
    function listenNotes(isAdmin){
      const base=db.collection('notes');
      const q=isAdmin?base.orderBy('ts','desc'):base.where('uid','==',currentUID).orderBy('ts','desc');
      q.onSnapshot(snap=>{
        notesList.innerHTML='';
        if(snap.empty){notesList.innerHTML='<p class="text-center text-white/80">Belum ada catatan.</p>';return;}
        snap.forEach(doc=>renderCard(doc,isAdmin));
      });
    }

    function renderCard(doc,isAdmin){
      const data=doc.data();
      const node=tpl.content.cloneNode(true);
      const card=node.querySelector('article');
      const p=node.querySelector('p');
      const time=node.querySelector('time');
      const author=node.querySelector('[data-author]');
      const del=node.querySelector('button');
      p.textContent=data.text;
      time.textContent=data.ts?timeAgo(data.ts.toDate()):'â€¦';
      if(isAdmin){
        author.textContent=data.name||data.uid.substring(0,6)+'â€¦';
      }
      del.onclick=()=>{if(confirm('Hapus catatan?'))doc.ref.delete();};
      requestAnimationFrame(()=>card.classList.remove('fade-enter'));
      notesList.appendChild(node);
    }

    // ===== ADD NOTE =====
    noteForm.onsubmit=async e=>{
      e.preventDefault();
      const text=noteInput.value.trim();
      if(!text)return;
      await db.collection('notes').add({
        uid:currentUID,
        name:nameInput.value.trim()||null,
        text,
        ts:firebase.firestore.FieldValue.serverTimestamp()
      });
      noteInput.value='';
      nameInput.value='';
    };
  </script>
</body>
</html>
